<!DOCTYPE html>

<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
		<title>地图数据可视化</title>
		<link rel="stylesheet" href="../../static/hyyj/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../static/hyyj/css/app.css" />
	</head>
	
	<body class="bg01">
		<header class="header">
			<h3>淮滨疫情大数据</h3>
		</header>
		<div>
			<!--<ul class="" style="color: white;float:left;list-style-type:none">
				<li class="active"><span class="badge pull-right">42</span>首页</a></li>
				<li><span class="label label-info ">123</span>疑似</li>
				<li>死亡<span>12</span></li>
				<li>隔离<span>1234</span></li>
			</ul>-->
		</div>
		<div class="wrapper">
			<div class="container-fluid">
				<div class="row fill-h">
					<div class="col-lg-3 fill-h">
						<div class="xpanel-wrapper xpanel-wrapper-2">
							<div class="xpanel">
								<!-- 外来人员地图 -->
								<div class="fill-h" id="flyMap"></div>
							</div>
						</div>
						<div class="xpanel-wrapper xpanel-wrapper-2">
							<div class="xpanel">
								<!-- 各类人员占比-->
								 <div class="fill-h" id="everyTypePeoplePie"></div>
							</div>
						</div>
					</div>
					<div class="col-lg-6 fill-h">
						<div class="xpanel-wrapper xpanel-wrapper-1">
							<div class="xpanel">
								<!-- 各乡镇人员数地图 -->
								<div class="fill-h" id="scatterMap"></div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 fill-h">
						<div class="xpanel-wrapper xpanel-wrapper-3">
							<div class="xpanel">
								<!-- 各乡镇人员数柱状图 -->
								<div class="fill-h" id="everyCoutrySum"></div>
							</div>
						</div>
						<div class="xpanel-wrapper xpanel-wrapper-3">
							<div class="xpanel">
								<!-- 每日人员总数折线 -->
								<div class="fill-h" id="everyDayPeopleSum"></div>
							</div>
						</div>
						<div class="xpanel-wrapper xpanel-wrapper-3">
							<div class="xpanel">
								<!-- 区县地图 -->
								<div class="fill-h" id="everyHospitalSum"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script type="text/javascript" src="../../static/framework/js/echarts/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="../../static/framework/js/echarts/echarts-3.8.5.min.js"></script>
		<script type="text/javascript" src="../../static/framework/js/echarts/echarts-map-china.js"></script>
		<script type="text/javascript" src="../../static/framework/js/echarts/echarts-china-provinces/henan.js"></script>
		<script type="text/javascript" src="../../static/framework/js/echarts/echarts-china-counties/huaibin.js"></script>
		<script type="text/javascript">
			$(function() {
				/******************* 地图飞线 ******************/
				//初始化echarts实例
				const flyMap = echarts.init(document.getElementById("flyMap"));
		        //城市经纬度
		        const originName = '淮滨';
		        const flyGeo = {
                    '淮滨': [115.41721343994142,32.4728398436205],
		        	'郑州': [113.62536799999998,34.7466],
		            '成都': [104.081534, 30.655822],
		            '重庆': [106.558434, 29.568996],
		            '昆明': [102.852448, 24.873998],
		            '贵阳': [106.636577, 26.653325],
		            '武汉': [114.311582, 30.598467],
		            '长沙': [112.945473, 28.234889],
		            '南昌': [115.864589, 28.689455],
		            '合肥': [117.233443, 31.826578],
		            '杭州': [120.215503, 30.253087],
		            '广州': [113.271431, 23.135336],
		            '北京': [116.413384, 39.910925],
		            '天津': [117.209523, 39.093668]
		        };
		        //飞线数据
		        var flyVal = [
		            [{name: '淮滨'}, {name: '郑州', value: 100}],
		            [{name: '淮滨'}, {name: '成都', value: 35}],
		            [{name: '淮滨'}, {name: '重庆', value: 40}],
		            [{name: '淮滨'}, {name: '昆明', value: 50}],
		            [{name: '淮滨'}, {name: '贵阳', value: 55}],
		            [{name: '淮滨'}, {name: '武汉', value: 65}],
		            [{name: '淮滨'}, {name: '长沙', value: 70}],
		            [{name: '淮滨'}, {name: '南昌', value: 75}],
		            [{name: '淮滨'}, {name: '合肥', value: 80}],
		            [{name: '淮滨'}, {name: '杭州', value: 85}],
		            [{name: '淮滨'}, {name: '广州', value: 90}],
		            [{name: '淮滨'}, {name: '北京', value: 95}],
		            [{name: '淮滨'}, {name: '天津', value: 60}],
		        ];
		        //数据转换，转换后格式：[{fromName:'cityName', toName:'cityName', coords:[[lng, lat], [lng, lat]]}, {...}]
		        const convertFlyData = function(data) {
		            let res = [];
		            for(let i=0;i<data.length;i++) {
		                let dataItem = data[i];
		                let toCoord = flyGeo[dataItem[0].name];
		                let fromCoord = flyGeo[dataItem[1].name];
		                if(fromCoord && toCoord) {
		                    res.push({
		                        fromName: dataItem[1].name, 
		                        toName: dataItem[0].name, 
		                        coords: [fromCoord, toCoord]
		                    });
		                }
		            }
		            return res;
		        };
		        //报表配置
		        const flySeries = [];
		        [[originName, flyVal]].forEach(function(item, i) {
					flySeries.push({   
				        name: item[0],
				        type: 'lines',
				        zlevel: 1,
				        symbol: ['none', 'none'],
				        symbolSize: 0,
				        effect: { //特效线配置
				            show: true,
				            period: 5, //特效动画时间，单位s
				            trailLength: 0.1, //特效尾迹的长度，从0到1
				            symbol: 'arrow',
				            symbolSize: 5
				        },
				        lineStyle: {
				            normal: {
				                color: '#f19000',
				                width: 1,
				                opacity: 0.6,
				                curveness: 0.2 //线的平滑度
				            }
				        },
				        data: convertFlyData(item[1])
				    }, {
				        name: item[0],
				        type: 'effectScatter',
				        coordinateSystem: 'geo',
				        zlevel: 2,
				        rippleEffect: { //涟漪特效
				            period: 5, //特效动画时长 
				            scale: 4, //波纹的最大缩放比例
				            brushType: 'stroke' //波纹的绘制方式：stroke | fill
				        },
				        label: {
				            normal: {
				                show: false,
				                position: 'right',
				                formatter: '{b}'
				            }
				        },
				        symbol: 'circle',
				        symbolSize: function (val) {
				        	//根据某项数据值设置符号大小
				            return val[2] / 10; 
				        },
				        itemStyle: {
				            normal: {
				            	color: '#f19000'
				            }
				        },
				        data: item[1].map(function(dataItem) {
				            return {
				                name: dataItem[1].name,
				                value: flyGeo[dataItem[1].name].concat([dataItem[1].value])
				            };
				        })
				    }, { //与上层的点叠加
				    	name: item[0],
				        type: 'scatter',
				        coordinateSystem: 'geo',
				        zlevel: 3,
				        symbol: 'circle',
				        symbolSize: function (val) {
				        	//根据某项数据值设置符号大小
				            return val[2] / 15; 
				        },
				        itemStyle: {
				            normal: {
				            	color: '#f00'
				            }
				        },
				        data: item[1].map(function(dataItem) {
				            return {
				                name: dataItem[1].name,
				                value: flyGeo[dataItem[1].name].concat([dataItem[1].value])
				            };
				        })
				    });
		        });
	
				//报表配置项
				const flyMapOpt = {
					title: {
						show: true,
						text: '疫情严重地区来淮滨人数统计',
						x: 'center',
						textStyle: {
							color: '#fff',
                            fontSize: 14
						}
					},
	                tooltip: {
	                    trigger: 'item',
	                    formatter: function(params) {
	                        if(params.value) {
	                            return params.name + ' : ' + params.value[2];
	                        }else {
	                            return params.name;
	                        }
	                    }
	                },
				    geo: {
				        map: 'china',
				        roam: false, //开启鼠标缩放和漫游
				        zoom: 1, //地图缩放级别
						selectedMode: false, //选中模式：single | multiple
						left: 0,
						right: 0,
						top: 0,
						bottom: 0,
						layoutCenter: ['50%', '50%'], //设置后left/right/top/bottom等属性无效
						layoutSize: '100%', //保持地图宽高比
				        label: {
				            emphasis: {
				                show: false
				            }
				        },
				        itemStyle: {
				            normal: {
				                areaColor: '#101f32',
				                borderWidth: 1.1,
				                borderColor: '#43d0d6'
				            },
				            emphasis: {
				                areaColor: '#069'
				            }
				        }
				    },
				    series: flySeries
				};
				//渲染报表
				flyMap.setOption(flyMapOpt);
				
				/***************** 地图散点 ******************/
				//初始化echarts实例
				const scatterMap = echarts.init(document.getElementById("scatterMap"));
				//城市经纬度
				const scatterGeo = {
				    "期思镇":[115.48141479492189,32.34574191355548],
				    "赵集镇":[115.26597976684572,32.57023380692363],
				    "防胡镇":[115.12062800000001,32.53828],
				    "马集镇":[115.25756835937501,32.434164216579205],
				    "城关镇":[115.41893005371095,32.44227733437236]
				};
				//城市数据
				const scatterVal = [
					{name: "期思镇", value: 9},
	                {name: "赵集镇", value: 12},
	                {name: "防胡镇", value: 172},
	                {name: "马集镇", value: 12},
	                {name: "城关镇", value: 194}
				];
				//数据转换，转换后的格式：[{name: 'cityName', value: [lng, lat, val]}, {...}]
				const convertScatterData = function(data) {
				    let res = [];
				    for(let i=0;i<data.length;i++) {
				        let geoCoord = scatterGeo[data[i].name];
				        if(geoCoord) {
				            res.push({
				                name: data[i].name,
				                value: geoCoord.concat(data[i].value)
				            });
				        }
				    }
				    return res;
				};
				//地图配置项
				const sactterMapOpt = {
					title: {
						text: '淮滨疫情分布',
						x: 'center',
						textStyle: {
							color: '#fff'
						}
					},
					legend: {
						data: ['疫情分布'], //与series的name属性对应
				        orient: 'vertical',
				        y: 'bottom',
				        x: 'right',
				        textStyle: {
				            color: '#fff'
				        }
				    },
					tooltip: {
				        trigger: 'item',
				        formatter: function(params) {
				            return params.name + ' : ' + params.value[2];
				        }
				    },
				    visualMap: {
				        min: 0,
				        max: 200,
				        calculable: true,
				        inRange: {
				            color: ['#50a3ba', '#eac736', '#d94e5d']
				        },
				        textStyle: {
				            color: '#fff'
				        }
				    },
					geo: {
				        map: '淮滨县',
				        roam: true, //开启鼠标缩放和漫游
				        zoom: 1, //地图缩放级别
						selectedMode: false, //选中模式：single | multiple
						left: 0,
						right: 0,
						top: 0,
						bottom: 0,
						layoutCenter: ['50%', '50%'], //设置后left/right/top/bottom等属性无效
						layoutSize: '100%',
				        label: {
				            emphasis: {
				                show: false
				            }
				        },
				        itemStyle: {
				            normal: {
				                areaColor: '#1d6780',
				                borderWidth: 1.1,
				                borderColor: '#43d0d6'
				            },
				            emphasis: {
				                areaColor: '#069'
				            }
				        }
				    },
				    series: [{
			            name: '确诊人员数',
			            type: 'scatter',
			            coordinateSystem: 'geo',
			            symbolSize: 25,
			            label: {
			                normal: {
			                    show: true
			                },
			                emphasis: {
			                    show: true
			                }
			            },
			            itemStyle: {
			                emphasis: {
			                    borderColor: '#fff',
			                    borderWidth: 1
			                }
			            },
			            data: convertScatterData(scatterVal)
			        }]
				};
				//渲染报表
				scatterMap.setOption(sactterMapOpt);
				
			

				/******************* 各乡镇人员统计柱状图 ******************/
	const everyCoutrySum = echarts.init(document.getElementById("everyCoutrySum"));
	const app={};	
	var posList = [
		'left', 'right', 'top', 'bottom',
		'inside',
		'insideTop', 'insideLeft', 'insideRight', 'insideBottom',
		'insideTopLeft', 'insideTopRight', 'insideBottomLeft', 'insideBottomRight'
	];

	app.configParameters = {
		rotate: {
			min: -90,
			max: 90
		},
		align: {
			options: {
				left: 'left',
				center: 'center',
				right: 'right'
			}
		},
		verticalAlign: {
			options: {
				top: 'top',
				middle: 'middle',
				bottom: 'bottom'
			}
		},
		position: {
			options: echarts.util.reduce(posList, function (map, pos) {
				map[pos] = pos;
				return map;
			}, {})
		},
		distance: {
			min: 0,
			max: 100
		}
	};

	app.config = {
		rotate: 90,
		align: 'left',
		verticalAlign: 'middle',
		position: 'insideBottom',
		distance: 15,
		onChange: function () {
			var labelOption = {
				normal: {
					rotate: app.config.rotate,
					align: app.config.align,
					verticalAlign: app.config.verticalAlign,
					position: app.config.position,
					distance: app.config.distance
				}
			};
			myChart.setOption({
				series: [{
					label: labelOption
				}, {
					label: labelOption
				}, {
					label: labelOption
				}, {
					label: labelOption
				}]
			});
		}
	};


	var labelOption = {
		show: true,
		position: app.config.position,
		distance: app.config.distance,
		align: app.config.align,
		verticalAlign: app.config.verticalAlign,
		rotate: app.config.rotate,
		formatter: '{c}  {name|{a}}',
		fontSize: 16,
		rich: {
			name: {
				textBorderColor: '#fff'
			}
		}
	};

	baroption = {
        title: {
            show: true,
            text: '各乡镇疫情人员统计',
            x: 'center',
            textStyle: {
                color: '#fff',
                fontSize: 14
            }
        },
        grid: {
            top: '15%',
            left: '0%',
            right: '5%',
            bottom: '10%',
            containLabel: true
        },
		color: ['#003366', '#006699', '#4cabce', '#e5323e'],
		tooltip: {
			trigger: 'axis',
			axisPointer: {
				type: 'shadow'
			}
		},
		legend: {
			data: ['确诊', '疑似', '死亡', '隔离'],
            orient:"horizontal",
            padding:[220, 30,0,0],
            textStyle:{

                color:'white',

            }
		},
		toolbox: {
			show: false,
			orient: 'vertical',
			left: 'right',
			top: 'center',
			feature: {
				mark: {show: false},
				dataView: {show: false, readOnly: false},
				magicType: {show: false, type: ['line', 'bar', 'stack', 'tiled']},
				restore: {show: false},
				saveAsImage: {show: false}
			}
		},
		xAxis: [
			{
				type: 'category',
				axisTick: {show: false},
				data: ['城关镇', '马集镇', '防胡镇', '赵集镇镇', '期思镇'],
				axisLabel: {
                    interval: 0,
			    show: true,
				textStyle: {
				  color: '#c3dbff',  //更改坐标轴文字颜色
				  fontSize : 12      //更改坐标轴文字大小
        }
     }
			}
		],
		yAxis: [
			{
				type: 'value',
                axisLabel: {
                    textStyle: {
                        color: 'white',
                        fontSize:9
                    }
                },
                splitLine:{//去除网格线
                    show:false,
                    showContent:true
                }
			}
		],tooltip: {
            trigger: 'axis'
        },
		series: [
			{
				name: '确诊',
				type: 'bar',
				barGap: 0,
				label: labelOption,
				data: [320, 332, 301, 334, 390]
			},
			{
				name: '疑似',
				type: 'bar',
				label: labelOption,
				data: [220, 182, 191, 234, 290]
			},
			{
				name: '死亡',
				type: 'bar',
				label: labelOption,
				data: [150, 232, 201, 154, 190]
			},
			{
				name: '隔离',
				type: 'bar',
				label: labelOption,
				data: [98, 77, 101, 99, 40]
			}
		]
	};

    everyCoutrySum.setOption(baroption);


	/**************各类人员占总人员占比*************************************/
	
const everyTypePeoplePie = echarts.init(document.getElementById("everyTypePeoplePie"));	
	var data = [{
    name: 'XX镇',
    value: 70
}, {
    name: 'XX镇',
    value: 68
}, {
    name: 'XX乡',
    value: 48
}, {
    name: 'XX镇',
    value: 40
}, {
    name: 'XX乡',
    value: 32
}, {
    name: 'XX镇',
    value: 27
}, {
    name: 'XX区',
    value: 18
}];

pieoption = {
    title: [{
        text: '各类疫情人员在各乡镇占比',
        textStyle: {
            fontSize: 14,
            fontStyle: 'normal',
            fontWeight: 'normal',
            color: 'white'
        }
    }, {
        subtext: '确认',
        left: '20%',
        top: '35%',
        textAlign: 'center'
    }, {
        subtext: '疑似',
        left: '20%',
        top: '85%',
        textAlign: 'center'
    }, {
        subtext: '死亡',
        left: '75%',
        top: '35%',
        textAlign: 'center'
    },{
		subtext: '隔离',
		left: '75%',
		top: '85%',
		textAlign: 'center'
        }],
    series: [{
        type: 'pie',
        radius: '25%',
        center: ['25%', '25%'],
        data: data,
        animation: false,
        label: {
            position: 'outer',
            alignTo: 'none',
            bleedMargin: 5
        },
        left: 0,
        right: '66.6667%',
        top: 0,
        bottom: 0
    }, {
        type: 'pie',
        radius: '25%',
        center: ['25%', '75%'],
        data: data,
        animation: false,
        label: {
            position: 'outer',
            alignTo: 'labelLine',
            bleedMargin: 5
        },
        left: '33.3333%',
        right: '33.3333%',
        top: 0,
        bottom: 0
    }, {
        type: 'pie',
        radius: '25%',
        center: ['75%', '25%'],
        data: data,
        animation: false,
        label: {
            position: 'outer',
            alignTo: 'edge',
            margin: 20
        },
        left: '66.6667%',
        right: 0,
        top: 0,
        bottom: 0
    },{
        type: 'pie',
        radius: '25%',
        center: ['75%', '75%'],
        data: data,
        animation: false,
        label: {
            position: 'outer',
            alignTo: 'edge',
            margin: 20
        },
        left: '66.6667%',
        right: 0,
        top: 0,
        bottom: 0
    }]
};

everyTypePeoplePie.setOption(pieoption);


/************************** 每日人数折线图**********************/
const everyDayPeopleSum = echarts.init(document.getElementById("everyDayPeopleSum"));
   lineoption = {
       grid: {
           top: '16%',
           left: '0%',
           right: '8%',
           bottom: '-10%',
           containLabel: true
       },
		xAxis: {
			type: 'category',
			data: ['2020-02-01', '2020-02-02', '2020-02-03', '2020-02-04', '2020-02-05', '2020-02-06', '2020-02-07'],
            axisLabel: {
                rotate: 45, // 旋转角度
                interval: 0 , //设置X轴数据间隔几个显示一个，为0表示都显示
                textStyle: {
                    color: 'white',
					fontSize:9
                }
            },
            boundaryGap: false
		},
		yAxis: {
			type: 'value',
            axisLabel: {
                textStyle: {
                    color: 'white',
                    fontSize:9
                }
            },
            splitLine:{//去除网格线
                show:false
            }
		},
		series: [{
			data: [100, 157, 340, 675, 789, 891, 921],
			type: 'line',
            smooth: true
		}]
	};
everyDayPeopleSum.setOption(lineoption)


                /**************************各医院人员收治人数统计**************************************/
const everyHospitalSum = echarts.init(document.getElementById("everyHospitalSum"));
const config={};
var posList = [
	'left', 'right', 'top', 'bottom',
	'inside',
	'insideTop', 'insideLeft', 'insideRight', 'insideBottom',
	'insideTopLeft', 'insideTopRight', 'insideBottomLeft', 'insideBottomRight'
];

 config.configParameters = {
	rotate: {
		min: -90,
		max: 90
	},
	align: {
		options: {
			left: 'left',
			center: 'center',
			right: 'right'
		}
	},
	verticalAlign: {
		options: {
			top: 'top',
			middle: 'middle',
			bottom: 'bottom'
		}
	},
	position: {
		options: echarts.util.reduce(posList, function (map, pos) {
			map[pos] = pos;
			return map;
		}, {})
	},
	distance: {
		min: 0,
		max: 100
	}
};

config.config = {
	rotate: 90,
	align: 'left',
	verticalAlign: 'middle',
	position: 'insideBottom',
	distance: 15,
	onChange: function () {
		var labelOption = {
			normal: {
				rotate: config.config.rotate,
				align: config.config.align,
				verticalAlign: config.config.verticalAlign,
				position: config.config.position,
				distance: config.config.distance
			}
		};
		myChart.setOption({
			series: [{
				label: labelOption
			}, {
				label: labelOption
			}, {
				label: labelOption
			}, {
				label: labelOption
			}]
		});
	}
};


var labelOption = {
	show: true,
	position: config.config.position,
	distance: config.config.distance,
	align: config.config.align,
	verticalAlign: config.config.verticalAlign,
	rotate: config.config.rotate,
	formatter: '{c}  {name|{a}}',
	fontSize: 16,
	rich: {
		name: {
			textBorderColor: '#fff'
		}
	}
};

baroption2 = {
	title: {
		show: true,
		text: '各医院疫情人员统计',
		x: 'center',
		textStyle: {
			color: '#fff',
			fontSize: 14
		}
	},
	grid: {
		top: '15%',
		left: '0%',
		right: '5%',
		bottom: '-10%',
		containLabel: true
	},
	color: ['#003366', '#006699', '#4cabce', '#e5323e'],
	tooltip: {
		trigger: 'axis',
		axisPointer: {
			type: 'shadow'
		}
	},
	legend: {
		data: ['确诊', '疑似', '死亡', '隔离'],
		orient:"horizontal",
		padding:[220, 30,0,0],
		textStyle:{

			color:'white',

		}
	},
	toolbox: {
		show: false,
		orient: 'vertical',
		left: 'right',
		top: 'center',
		feature: {
			mark: {show: false},
			dataView: {show: false, readOnly: false},
			magicType: {show: false, type: ['line', 'bar', 'stack', 'tiled']},
			restore: {show: false},
			saveAsImage: {show: false}
		}
	},
	xAxis: [
		{
			type: 'category',
			axisTick: {show: false},
			data: ['县人民医院', '县中医院', '第二人民医院', '妇幼保健院', '公疗医院'],
			axisLabel: {
				interval: 0,
                rotate: 45,
				show: true,
				textStyle: {
					color: '#c3dbff',  //更改坐标轴文字颜色
					fontSize : 9      //更改坐标轴文字大小
				}
			}
		}
	],
	yAxis: [
		{
			type: 'value',
			axisLabel: {
				textStyle: {
					color: 'white',
					fontSize:9
				}
			},
			splitLine:{//去除网格线
				show:false,
				showContent:true
			}
		},
	],tooltip: {
		trigger: 'axis'
	},
	series: [
		{
			name: '确诊',
			type: 'bar',
			barGap: 0,
			label: labelOption,
			data: [32, 33, 30, 34, 30]
		},
		{
			name: '疑似',
			type: 'bar',
			label: labelOption,
			data: [20, 18, 19, 23, 20]
		},
		{
			name: '死亡',
			type: 'bar',
			label: labelOption,
			data: [10, 22, 20, 14, 10]
		},
		{
			name: '隔离',
			type: 'bar',
			label: labelOption,
			data: [98, 77, 101, 99, 40]
		}
	]
};

everyHospitalSum.setOption(baroption2);


	/********** 浏览器窗口改变时，重置报表大小 ****************/
	window.onresize = function() {
		flyMap.resize();
		scatterMap.resize();
		everyTypePeoplePie.resize();
		coutryCount.resize();
	}
});
</script>
	</body>
</html>